# 라즈베리파이 운영용 설정
version: "3.8"

services:
  nginx:
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro # 실제 Let's Encrypt 경로
      - /var/www/certbot:/var/www/certbot
    restart: unless-stopped

  server:
    restart: unless-stopped

  mysql:
    volumes:
      - mysql_data:/var/lib/mysql # 'mysql_data' 볼륨 사용
      - ./db/init:/docker-entrypoint-initdb.d
    restart: unless-stopped
  
  redis:
    volumes:
      - redis_data:/data # 'redis_data' 볼륨 사용
    restart: unless-stopped

# [중요] 라즈베리파이 전용 SSD 경로 설정
volumes:
  mysql_data:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: '/mnt/ssd/moup/mysql' # (실제 RPi SSD 경로)

  redis_data:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: '/mnt/ssd/moup/redis' # (실제 RPi SSD 경로)
